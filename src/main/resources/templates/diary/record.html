<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>일기 상세보기</title>
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/main.css">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
  <div th:replace="~{fragments/member-sidebar :: memberSidebar}"></div>

<!--  class = main으로 바꿔서 여기에 다 있음 -->
  <main class="main">
    <div class="button-group">
      <button onclick="goBack()">뒤로가기</button>
      <button onclick="editDiary()">수정</button>
      <button onclick="deleteDiary()">삭제</button>
    </div>

    <div th:if="${diary}">
      <h2 th:text="${#temporals.format(diary.date, 'yyyy-MM-dd')}">날짜</h2>
      <p th:text="${diary.content}">일기 내용</p>

      <!-- 감정 -->
      <p>오늘의 감정: <span th:text="${diary.emotion}"></span></p>

      <!-- 키워드 -->
      <div th:if="${diary.keywordNames}">
        <h4>선택된 키워드</h4>
        <ul>
          <li th:each="kw : ${diary.keywordNames}" th:text="${kw}"></li>
        </ul>
      </div>

      <!-- 이미지 -->
      <div th:if="${diary.images}">
        <h4>첨부 이미지</h4>
        <div th:each="image : ${diary.images}">
          <img th:src="@{${image.path}}" th:alt="${image.originName}" width="150">
        </div>
      </div>

      <!-- AI 답변 -->

      <div class="form-box">
        <div th:if="${diary.reply != null}">
          <h4>AI의 답변</h4>
          <p th:text="${diary.reply.content}"></p>
        </div>
        <div th:unless="${diary.reply != null}">
          <p>아직 답변이 없습니다.</p>
        </div>
      </div>

    </div>
  </main>
  <script th:inline="javascript">
    function goBack() {
      window.history.back();
    }

    function editDiary() {
      const diaryId = '[[${diary.diaryId}]]';
      window.location.href = `/diary/edit/${diaryId}`;
    }

    function deleteDiary() {
      const diaryId = [[${diary.diaryId}]];
      if (confirm("정말로 삭제하시겠습니까?")) {
        fetch(`/api/diary/${diaryId}`, {
          method: 'DELETE'
        })
        .then(response => {
          if (response.ok) {
            alert("삭제되었습니다.");
            window.location.href = "/app";
          } else {
            alert("삭제에 실패했습니다.");
          }
        });
      }
    }
  </script>
  <script src="/js/sidebar.js"></script>
</body>
</html>